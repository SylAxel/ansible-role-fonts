# This source file is subject to the (Open Source Initiative) BSD license
# that is bundled with this package in the LICENSE file. It is also available
# through the world-wide-web at this URL: http://www.ontic.com.au/license.html
# If you did not receive a copy of the license and are unable to obtain it through
# the world-wide-web, please send an email to license@ontic.com.au immediately.
# Copyright (c) 2010-2016 Ontic. (http://www.ontic.com.au). All rights reserved.

---

- name: 'Fonts | Debian | Update repository list.'
  become: yes
  apt_repository:
    repo: '{{ item }}'
    state: 'present'
    update_cache: false
  register: 'fonts_multiverse_installed'
  with_items:
    - 'deb http://archive.ubuntu.com/ubuntu {{ ansible_distribution_release }} multiverse'
    - 'deb-src http://archive.ubuntu.com/ubuntu {{ ansible_distribution_release }} multiverse'
    - 'deb http://archive.ubuntu.com/ubuntu {{ ansible_distribution_release }}-updates multiverse'
    - 'deb-src http://archive.ubuntu.com/ubuntu {{ ansible_distribution_release }}-updates multiverse'
  when: '{{ ansible_os_family == "Debian" }}'

- name: 'Fonts | Debian | Update APT cache.'
  become: yes
  apt:
    update_cache: yes
  when: '{{ ansible_os_family == "Debian" and fonts_multiverse_installed.changed }}'

- name: 'Fonts | Debian | Install Microsoft Core Fonts prerequisites.'
  become: yes
  apt:
    name: '{{ item }}'
    state: 'present'
  with_items:
    - 'libfreetype6'
    - 'libfreetype6-dev'
    - 'libfontconfig1'
  when: '{{ ansible_os_family == "Debian" }}'

- name: 'Fonts | Debian | Accept Microsoft Core Fonts EULA.'
  become: yes
  debconf:
    name: 'ttf-mscorefonts-installer'
    question: 'msttcorefonts/accepted-mscorefonts-eula'
    value: 'true'
    vtype: 'select'
  when: '{{ ansible_os_family == "Debian" }}'

- name: 'Fonts | Debian | Install Microsoft Core Fonts.'
  become: yes
  apt:
    name: 'ttf-mscorefonts-installer'
    state: 'present'
  register: 'fonts_microsoft_installed'
  when: '{{ ansible_os_family == "Debian" }}'

- name: 'Fonts | RedHat | Install Microsoft Core Fonts prerequisites.'
  become: yes
  yum:
    name: '{{ item }}'
    state: 'present'
  with_items:
    - 'curl'
    - 'cabextract'
    - 'xorg-x11-font-utils'
    - 'fontconfig'
  when: '{{ ansible_os_family == "RedHat" }}'

- name: 'Fonts | RedHat | Install Microsoft Core Fonts.'
  become: yes
  yum:
    name: 'https://downloads.sourceforge.net/project/mscorefonts2/rpms/msttcore-fonts-installer-2.6-1.noarch.rpm'
    state: 'present'
  when: '{{ ansible_os_family == "RedHat" }}'